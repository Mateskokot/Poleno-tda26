<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kurzy</title>
  <link rel="stylesheet" href="/style.css">
</head>

<body>
<header class="topbar">
  <div class="topbar__inner">
    <a class="logo-link" href="/index.html">
      <img src="/images/logo.png" alt="Think Different Academy">
    </a>
    <nav class="nav">
      <a class="nav__link" href="/index.html">Domů</a>
    </nav>
  </div>
</header>

<main class="container">
  <h1>Kurzy</h1>

  <div class="card">
    <label class="small" for="search">Hledat kurz podle názvu</label><br>
    <input type="text" id="search" placeholder="Napiš název kurzu…">
  </div>

  <div id="courses"></div>
</main>

<footer class="footer">
  <div class="container">
    <small>© Think Different Academy</small>
  </div>
</footer>

<script>
async function loadCourses() {
  const res = await fetch("/api/courses", { method: "GET" });
  if (!res.ok) {
    const txt = await res.text().catch(() => "");
    throw new Error(`Nelze načíst kurzy (${res.status}): ${txt}`);
  }
  return await res.json();
}

function openDetail(courseId) {
  window.location.assign(`/courseDetail.html?id=${encodeURIComponent(courseId)}`);
}

function renderCourses(courses) {
  const root = document.getElementById("courses");
  root.innerHTML = "";

  if (!Array.isArray(courses)) {
    root.innerHTML =
      "<p class='small' style='color:#ff6b6b;'>API nevrátilo seznam kurzů (očekávám pole).</p>";
    return;
  }

  if (courses.length === 0) {
    root.innerHTML =
      "<p class='small'><em>Žádné kurzy nejsou k dispozici.</em></p>";
    return;
  }

  courses.forEach(c => {
    const id = c.id ?? c.uuid ?? c.courseId;
    const title = c.title ?? c.name ?? "";
    const description = c.description ?? "";
    const lecturer = c.lecturer ?? c.lecturerName ?? "";

    const card = document.createElement("div");
    card.className = "card";
    card.style.cursor = id ? "pointer" : "default";

    if (id) card.onclick = () => openDetail(id);

    card.innerHTML = `
      <h3>${title}</h3>
      <p>${description}</p>
      <p class="small">Lektor: ${lecturer}</p>
      ${id ? "<p class='small' style='opacity:.6;'>Klikni pro detail kurzu</p>" : ""}
    `;

    root.appendChild(card);
  });
}

(async () => {
  const search = document.getElementById("search");
  const root = document.getElementById("courses");

  try {
    const courses = await loadCourses();
    renderCourses(courses);

    search.addEventListener("input", () => {
      const q = (search.value || "").toLowerCase().trim();
      renderCourses(
        courses.filter(c => (c.title ?? c.name ?? "").toLowerCase().includes(q))
      );
    });
  } catch (e) {
    root.innerHTML =
      "<p class='small' style='color:#ff6b6b;'>Chyba při načítání kurzů</p>";
    console.error(e);
  }
})();
</script>
</body>
</html>
