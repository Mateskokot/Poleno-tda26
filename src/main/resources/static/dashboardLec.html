<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard – Lektor</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>

<header class="topbar">
  <div class="topbar__inner">
    <a class="logo-link" href="/indexlec.html"><img src="/images/logo.png" alt="Think Different Academy"></a><nav class="nav">
      <a href="/indexlec.html" class="nav__link">Domů</a>
      <!-- ✅ OPRAVA: místo /courses.html používej route /courses -->
      <a href="/courses" class="nav__link">Kurzy</a>
      <a href="/manageLec.html" class="nav__link">Správa kurzu</a>
      <a href="#upload" class="nav__link">Materiály</a>
      <a href="/loginLec.html" class="nav__link nav__link--button" id="logoutBtn">Odhlásit</a>
    </nav>
  </div>
</header>

<main class="container">
  <h1>Dashboard lektora</h1>

  <div class="card" id="upload">
    <h2 style="margin-top:0;">Nahrání materiálu do kurzu</h2>

    <p class="small" id="status" style="margin-top:6px;"></p>

    <form id="uploadForm" class="form" enctype="multipart/form-data">
      <label>
        Kurz
        <select id="courseSelect" required>
          <option value="">Načítám kurzy…</option>
        </select>
      </label>

      <label>
        Název materiálu
        <input type="text" id="title" placeholder="Např. Prezentace – kapitola" required>
      </label>

      <label>
        Soubor
        <input type="file" id="file" multiple required>
      </label>

      <button type="submit">Nahrát materiál</button>
    </form>

    <hr style="margin:18px 0; opacity:.2;">

    <h2 style="margin-top:0;">Vložit odkaz (URL) do kurzu</h2>
    <form id="linkForm" class="form">
      <label>
        Kurz
        <select id="courseSelectLink" required>
          <option value="">Načítám kurzy…</option>
        </select>
      </label>

      <label>
        Název odkazu
        <input type="text" id="linkTitle" placeholder="Např. YouTube – kapitola 1" required>
      </label>

      <label>
        URL
        <input type="url" id="linkUrl" placeholder="https://..." required>
      </label>

      <label>
        Popis (volitelné)
        <input type="text" id="linkDesc" placeholder="Krátký popis">
      </label>

      <button type="submit">Přidat odkaz</button>
      <p class="small" id="linkStatus" style="margin-top:8px;"></p>
    </form>

    <hr style="margin:18px 0; opacity:.2;">

    <h2 style="margin-top:0;">Materiály ve vybraném kurzu</h2>
    <p class="small" style="margin-top:6px; opacity:.85;">Vyber kurz nahoře a materiály se zobrazí zde.</p>
    <div id="materialsList" class="small">—</div>

    <hr style="margin:18px 0; opacity:.2;">

    <h2 style="margin-top:0;">Kvízy – statistiky</h2>
    <p class="small" style="margin-top:6px; opacity:.85;">Vyber kurz a kvíz. Zobrazí se souhrnné statistiky.</p>

    <form id="quizStatsForm" class="form">
      <label>
        Kurz
        <select id="quizCourseSelect" required>
          <option value="">Načítám kurzy…</option>
        </select>
      </label>

      <label>
        Kvíz
        <select id="quizSelect" required>
          <option value="">Nejprve vyber kurz…</option>
        </select>
      </label>
    </form>

    <div id="quizStats" class="small" style="margin-top:10px;">—</div>
    <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
      <a id="openQuizManage" href="#" style="display:none;">Otevřít správu kvízu</a>
    </div>

    <hr style="margin:18px 0; opacity:.2;">

    <h3 style="margin:0 0 8px;">Moje kurzy</h3>
    <div id="coursesList" class="small">Načítám…</div>

    <p class="small" style="margin-top:12px; opacity:.8;">
      Debug: <span id="debugInfo">—</span>
    </p>
  </div>
</main>

<script>
// Musí být stejné jako v loginLec.html (js/LoginLec.js)
const TOKEN_KEY = "lecturerToken";

function getToken() {
  return localStorage.getItem(TOKEN_KEY);
}

function setStatus(text, isError = false) {
  const el = document.getElementById("status");
  el.textContent = text || "";
  el.style.color = isError ? "crimson" : "";
}

function setDebug(text) {
  const el = document.getElementById("debugInfo");
  if (el) el.textContent = text;
}

function requireLogin() {
  const token = getToken();
  if (!token) {
    window.location.href = "/loginLec.html";
    return false;
  }
  return true;
}

async function loadCourses() {
  if (!requireLogin()) return;

  const token = getToken();
  const select = document.getElementById("courseSelect");
  const selectLink = document.getElementById("courseSelectLink");
  const quizCourseSelect = document.getElementById("quizCourseSelect");
  const list = document.getElementById("coursesList");

  select.innerHTML = `<option value="">Načítám kurzy…</option>`;
  selectLink.innerHTML = `<option value="">

